<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>MongoDB(by python) | 哑舍</title><meta name="description" content="MongoDB(by python)"><meta name="keywords" content="数据库"><meta name="author" content="Machine"><meta name="copyright" content="Machine"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/cat2.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="MongoDB(by python)"><meta name="twitter:description" content="MongoDB(by python)"><meta name="twitter:image" content="https://machine4869.gitee.io/img/default_p2.jpeg"><meta property="og:type" content="article"><meta property="og:title" content="MongoDB(by python)"><meta property="og:url" content="https://machine4869.gitee.io/2019/03/04/20190304105434006/"><meta property="og:site_name" content="哑舍"><meta property="og:description" content="MongoDB(by python)"><meta property="og:image" content="https://machine4869.gitee.io/img/default_p2.jpeg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://machine4869.gitee.io/2019/03/04/20190304105434006/"><link rel="prev" title="python爬虫(3)-Scrapy框架" href="https://machine4869.gitee.io/2019/03/21/20190321133211318/"><link rel="next" title="python-杂项" href="https://machine4869.gitee.io/2019/03/01/20190301201943239/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://machine4869.gitee.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">哑舍</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 更多</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 豆瓣电影</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-picture-o"></i><span> 照片墙</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">134</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">45</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 更多</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 豆瓣电影</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-picture-o"></i><span> 照片墙</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#介绍-amp-安装"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">介绍&amp;安装</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#基本操作"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">基本操作</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#数据库的增删改"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">数据库的增删改</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#数据高级查询"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">数据高级查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#数据的备份和恢复"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">数据的备份和恢复</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#聚合和管道"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">聚合和管道</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#索引"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">索引</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#与python交互"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text">与python交互</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#介绍-amp-安装"><span class="toc-number">1.</span> <span class="toc-text">介绍&amp;安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#基本操作"><span class="toc-number">2.</span> <span class="toc-text">基本操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据库的增删改"><span class="toc-number">3.</span> <span class="toc-text">数据库的增删改</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据高级查询"><span class="toc-number">4.</span> <span class="toc-text">数据高级查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#数据的备份和恢复"><span class="toc-number">5.</span> <span class="toc-text">数据的备份和恢复</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#聚合和管道"><span class="toc-number">6.</span> <span class="toc-text">聚合和管道</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#索引"><span class="toc-number">7.</span> <span class="toc-text">索引</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#与python交互"><span class="toc-number">8.</span> <span class="toc-text">与python交互</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/img/default_p2.jpeg)"><div id="post-info"><div id="post-title"><div class="posttitle">MongoDB(by python)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-03-04<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2019-11-28</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><i class="fa fa-angle-right fa-fw" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/">MongoDB</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 12 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2019/03/04/20190304105434006/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2019/03/04/20190304105434006/" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><blockquote>
<p>参考：heima</p>
</blockquote>
<p>[TOC]</p>
<h1 id="介绍-amp-安装"><a href="#介绍-amp-安装" class="headerlink" title="介绍&amp;安装"></a>介绍&amp;安装</h1><p>关系型缺点</p>
<ul>
<li>扩展性差、大数据下IO压力大、表结构更改困难</li>
</ul>
<p>MongoDB优点</p>
<ul>
<li>易扩展、大数据量，高性能、灵活的数据模型</li>
</ul>
<p>安装：centos+yum安装mongodb</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置MongoDB的yum源</span></span><br><span class="line">$ vim /etc/yum.repos.d/mongodb-org-3.4.repo</span><br><span class="line"><span class="comment">#添加以下内容：</span></span><br><span class="line">[mongodb-org-3.4]  </span><br><span class="line">name=MongoDB Repository  </span><br><span class="line">baseurl=https://repo.mongodb.org/yum/redhat/<span class="variable">$releasever</span>/mongodb-org/3.4/x86_64/  </span><br><span class="line">gpgcheck=1  </span><br><span class="line">enabled=1  </span><br><span class="line">gpgkey=https://www.mongodb.org/static/pgp/server-3.4.asc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ yum makecache      </span><br><span class="line">$ yum -y install mongodb-org</span><br><span class="line"><span class="comment"># 查看mongo安装位置 </span></span><br><span class="line">$ whereis mongod</span><br><span class="line"><span class="comment"># 查看修改配置文件 ：</span></span><br><span class="line">$ vim /etc/mongod.conf</span><br><span class="line"><span class="comment"># 启动mongodb ：</span></span><br><span class="line">$ systemctl start mongod.service</span><br><span class="line"><span class="comment"># 启动Mongo shell</span></span><br><span class="line">$ mongo </span><br><span class="line"><span class="comment"># 查看数据库：</span></span><br><span class="line">&gt; show dbs</span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line">&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure></div>



<h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><ul>
<li>关于database的基础命令</li>
<li>关于集合的基础命令</li>
<li>数据类型</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、关于database的基础命令</span></span><br><span class="line"><span class="comment"># 查看当前的数据库：</span></span><br><span class="line">&gt; db</span><br><span class="line"><span class="comment"># 查看所有的数据库：</span></span><br><span class="line">&gt; show dbs</span><br><span class="line"><span class="comment"># 切换数据库：</span></span><br><span class="line">&gt; use db_name</span><br><span class="line"><span class="comment"># 删除当前的数据库：</span></span><br><span class="line">&gt; db.dropDatabase()</span><br><span class="line"><span class="comment"># 不用创建数据库，插数据时会自动创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、关于集合的基础命令</span></span><br><span class="line"><span class="comment"># 不手动创建集合：</span></span><br><span class="line"><span class="comment"># 向不存在的集合中第⼀次加⼊数据时， 集合会被创建出来</span></span><br><span class="line"><span class="comment"># 手动创建结合：</span></span><br><span class="line">&gt; db.createCollection(name,options)</span><br><span class="line">&gt; db.createCollection(<span class="string">"stu"</span>)</span><br><span class="line">&gt; db.createCollection(<span class="string">"sub"</span>, &#123; capped : <span class="literal">true</span>, size : 10 &#125; )</span><br><span class="line"><span class="comment"># 参数capped： 默认值为false表示不设置上限,值为true表示设置上限</span></span><br><span class="line"><span class="comment"># 参数size： 当capped值为true时， 需要指定此参数， 表示上限⼤⼩,当⽂档达到上限时， 会将之前的数据覆盖， 单位为字节</span></span><br><span class="line"><span class="comment"># 查看集合：</span></span><br><span class="line">&gt; show collections</span><br><span class="line"><span class="comment"># 删除集合：</span></span><br><span class="line">&gt; db.集合名称.drop()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、数据类型</span></span><br><span class="line">Object ID： ⽂档ID</span><br><span class="line">String： 字符串， 最常⽤， 必须是有效的UTF-8</span><br><span class="line">Boolean： 存储⼀个布尔值， <span class="literal">true</span>或<span class="literal">false</span></span><br><span class="line">Integer： 整数可以是32位或64位， 这取决于服务器</span><br><span class="line">Double： 存储浮点值</span><br><span class="line">Arrays： 数组或列表， 多个值存储到⼀个键</span><br><span class="line">Object： ⽤于嵌⼊式的⽂档， 即⼀个值为⼀个⽂档</span><br><span class="line">Null： 存储Null值</span><br><span class="line">Timestamp： 时间戳， 表示从1970-1-1到现在的总秒数</span><br><span class="line">Date： 存储当前⽇期或时间的UNIX时间格式</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建⽇期语句如下 ：参数的格式为YYYY-MM-DD</span></span><br><span class="line">&gt; new Date(<span class="string">'2017-12-20'</span>)</span><br><span class="line"><span class="comment"># 每个⽂档都有⼀个属性， 为_id， 保证每个⽂档的唯⼀性</span></span><br><span class="line"><span class="comment"># 可以⾃⼰去设置_id插⼊⽂档，如果没有提供， 那么MongoDB为每个⽂档提供了⼀个独特的_id， 类型为objectID</span></span><br><span class="line"><span class="comment"># objectID是⼀个12字节的⼗六进制数：</span></span><br><span class="line">前4个字节为当前时间戳</span><br><span class="line">接下来3个字节的机器ID</span><br><span class="line">接下来的2个字节中MongoDB的服务进程id</span><br><span class="line">最后3个字节是简单的增量值</span><br></pre></td></tr></table></figure></div>



<h1 id="数据库的增删改"><a href="#数据库的增删改" class="headerlink" title="数据库的增删改"></a>数据库的增删改</h1><ul>
<li>insert、save、update、remove</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 插入：insert</span></span><br><span class="line"><span class="comment"># test01会自动创建</span></span><br><span class="line">&gt; db.test01.insert(&#123;<span class="string">'name'</span>:<span class="string">'mxx'</span>,<span class="string">'age'</span>:10&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nInserted"</span> : 1 &#125;)</span><br><span class="line"><span class="comment"># _id自动生成，键值name可以不打引号</span></span><br><span class="line">&gt; db.test01.find()</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5c7cbe034cb2765ea56d825e"</span>), <span class="string">"name"</span> : <span class="string">"mxx"</span>, <span class="string">"age"</span> : 10 &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新：save</span></span><br><span class="line">&gt; db.集合名称.save(document)</span><br><span class="line"><span class="comment"># 如果⽂档的_id已经存在则修改， 如果⽂档的_id不存在则添加</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单查询</span></span><br><span class="line">&gt; db.集合名称.find()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新：update</span></span><br><span class="line">db.集合名称.update(&lt;query&gt; ,&lt;update&gt;,&#123;multi: &lt;boolean&gt;&#125;)</span><br><span class="line">参数query:查询条件</span><br><span class="line">参数update:更新操作符</span><br><span class="line">参数multi:可选， 默认是<span class="literal">false</span>，表示只更新找到的第⼀条记录， 值为<span class="literal">true</span>表示把满⾜条件的⽂档全部更新</span><br><span class="line"></span><br><span class="line">db.stu.update(&#123;name:<span class="string">'hr'</span>&#125;,&#123;name:<span class="string">'mnc'</span>&#125;)   更新一条，其他字段没了</span><br><span class="line">db.stu.update(&#123;name:<span class="string">'hr'</span>&#125;,&#123;<span class="variable">$set</span>:&#123;name:<span class="string">'hys'</span>&#125;&#125;)    更新一条，其他字段还在</span><br><span class="line">db.stu.update(&#123;&#125;,&#123;<span class="variable">$set</span>:&#123;gender:0&#125;&#125;,&#123;multi:<span class="literal">true</span>&#125;)   更新全部</span><br><span class="line"></span><br><span class="line">注意：<span class="string">"multi update only works with $ operators"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除：remove</span></span><br><span class="line">&gt; db.集合名称.remove(&lt;query&gt;,&#123;justOne: &lt;boolean&gt;&#125;)</span><br><span class="line">参数query:可选，删除的⽂档的条件</span><br><span class="line">参数justOne:可选， 如果设为<span class="literal">true</span>或1， 则只删除⼀条， 默认<span class="literal">false</span>， 表示删除多条</span><br></pre></td></tr></table></figure></div>



<h1 id="数据高级查询"><a href="#数据高级查询" class="headerlink" title="数据高级查询"></a>数据高级查询</h1><ul>
<li>数据查询、⽐较运算符、逻辑运算符、范围运算符、⽀持正则表达式、limit和skip、⾃定义查询*、投影、排序、统计个数、消除重复</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据查询</span></span><br><span class="line">⽅法find()： 查询</span><br><span class="line">	db.集合名称.find(&#123;条件⽂档&#125;)</span><br><span class="line">⽅法findOne()：查询，只返回第⼀个</span><br><span class="line">	db.集合名称.findOne(&#123;条件⽂档&#125;)</span><br><span class="line">⽅法pretty()： 将结果格式化</span><br><span class="line">	db.集合名称.find(&#123;条件⽂档&#125;).pretty()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ⽐较运算符</span></span><br><span class="line">等于： 默认是等于判断， 没有运算符</span><br><span class="line">⼩于：<span class="variable">$lt</span> （less than）</span><br><span class="line">⼩于等于：<span class="variable">$lte</span> （less than equal）</span><br><span class="line">⼤于：<span class="variable">$gt</span> （greater than）</span><br><span class="line">⼤于等于：<span class="variable">$gte</span></span><br><span class="line">不等于：<span class="variable">$ne</span></span><br><span class="line">&gt; db.stu.find(&#123;age:&#123;<span class="variable">$gte</span>:18&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逻辑运算符</span></span><br><span class="line">and：在json中写多个条件即可</span><br><span class="line">查询年龄⼤于或等于18， 并且性别为<span class="literal">true</span>的学⽣</span><br><span class="line">db.stu.find(&#123;age:&#123;<span class="variable">$gte</span>:18&#125;,gender:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line">or:使⽤<span class="variable">$or</span>， 值为数组， 数组中每个元素为json</span><br><span class="line">查询年龄⼤于18， 或性别为<span class="literal">false</span>的学⽣</span><br><span class="line">db.stu.find(&#123;<span class="variable">$or</span>:[&#123;age:&#123;<span class="variable">$gt</span>:18&#125;&#125;,&#123;gender:<span class="literal">false</span>&#125;]&#125;)</span><br><span class="line"></span><br><span class="line">查询年龄⼤于18或性别为男⽣， 并且姓名是郭靖</span><br><span class="line">db.stu.find(&#123;<span class="variable">$or</span>:[&#123;age:&#123;<span class="variable">$gte</span>:18&#125;&#125;,&#123;gender:<span class="literal">true</span>&#125;],name:<span class="string">'gj'</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 范围运算符</span></span><br><span class="line">使⽤<span class="string">"<span class="variable">$in</span>"</span>， <span class="string">"<span class="variable">$nin</span>"</span> 判断是否在某个范围内</span><br><span class="line">查询年龄为18、 28的学⽣</span><br><span class="line">db.stu.find(&#123;age:&#123;<span class="variable">$in</span>:[18,28]&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ⽀持正则表达式</span></span><br><span class="line">使⽤//或<span class="variable">$regex</span>编写正则表达式</span><br><span class="line">查询姓⻩的学⽣</span><br><span class="line">db.stu.find(&#123;name:/^⻩/&#125;)</span><br><span class="line">db.stu.find(&#123;name:&#123;<span class="variable">$regex</span>:<span class="string">'^⻩'</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># limit和skip</span></span><br><span class="line">⽅法<span class="built_in">limit</span>()： ⽤于读取指定数量的⽂档</span><br><span class="line">db.集合名称.find().<span class="built_in">limit</span>(NUMBER)</span><br><span class="line">查询2条学⽣信息</span><br><span class="line">db.stu.find().<span class="built_in">limit</span>(2)</span><br><span class="line"></span><br><span class="line">⽅法skip()： ⽤于跳过指定数量的⽂档</span><br><span class="line">db.集合名称.find().skip(NUMBER)</span><br><span class="line">db.stu.find().skip(2)</span><br><span class="line"></span><br><span class="line">同时使用</span><br><span class="line">db.stu.find().<span class="built_in">limit</span>(4).skip(5)</span><br><span class="line">或 </span><br><span class="line">db.stu.find().skip(5).<span class="built_in">limit</span>(4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ⾃定义查询*</span></span><br><span class="line">使⽤<span class="variable">$where</span>后⾯写⼀个函数， 返回满⾜条件的数据</span><br><span class="line">查询年龄⼤于30的学⽣</span><br><span class="line">db.stu.find(&#123;</span><br><span class="line">    <span class="variable">$where</span>:<span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> this.age&gt;30;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 投影</span></span><br><span class="line">在查询到的返回结果中， 只选择必要的字段</span><br><span class="line">db.集合名称.find(&#123;&#125;,&#123;字段名称:1,...&#125;)</span><br><span class="line">参数为字段与值， 值为1表示显示， 值为0不显</span><br><span class="line">特殊： 对于_id列默认是显示的， 如果不显示需要明确设置为0</span><br><span class="line"></span><br><span class="line">db.stu.find(&#123;&#125;,&#123;_id:0,name:1,gender:1&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line">⽅法sort()， ⽤于对	集进⾏排序</span><br><span class="line">db.集合名称.find().sort(&#123;字段:1,...&#125;)</span><br><span class="line">参数1为升序排列</span><br><span class="line">参数-1为降序排列</span><br><span class="line">根据性别降序， 再根据年龄升序</span><br><span class="line">db.stu.find().sort(&#123;gender:-1,age:1&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计个数</span></span><br><span class="line">⽅法count()⽤于统计结果集中⽂档条数</span><br><span class="line">db.集合名称.find(&#123;条件&#125;).count()</span><br><span class="line">db.集合名称.count(&#123;条件&#125;)</span><br><span class="line">db.stu.find(&#123;gender:<span class="literal">true</span>&#125;).count()</span><br><span class="line">db.stu.count(&#123;age:&#123;<span class="variable">$gt</span>:20&#125;,gender:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 消除重复</span></span><br><span class="line">⽅法distinct()对数据进⾏去重</span><br><span class="line">db.集合名称.distinct(<span class="string">'去重字段'</span>,&#123;条件&#125;)</span><br><span class="line"><span class="comment"># 年龄大于20的学生家乡 去重集合</span></span><br><span class="line">db.stu.distinct(<span class="string">'hometown'</span>,&#123;age:&#123;<span class="variable">$gt</span>:18&#125;&#125;)</span><br></pre></td></tr></table></figure></div>



<h1 id="数据的备份和恢复"><a href="#数据的备份和恢复" class="headerlink" title="数据的备份和恢复"></a>数据的备份和恢复</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">备份的语法：</span><br><span class="line">    mongodump -h dbhost -d dbname -o dbdirectory</span><br><span class="line">-h： 服务器地址， 也可以指定端⼝号</span><br><span class="line">-d： 需要备份的数据库名称</span><br><span class="line">-o： 备份的数据存放位置， 此⽬录中存放着备份出来的数据</span><br><span class="line"></span><br><span class="line">mongodump -h 192.168.196.128:27017 -d test1 -o ~/Desktop/test1bak</span><br><span class="line"></span><br><span class="line">恢复语法：</span><br><span class="line">     mongorestore -h dbhost -d dbname --dir dbdirectory</span><br><span class="line">-h： 服务器地址</span><br><span class="line">-d： 需要恢复的数据库实例</span><br><span class="line">--dir： 备份数据所在位置</span><br><span class="line"></span><br><span class="line">mongorestore -h 192.168.196.128:27017 -d test2 --dir ~/Desktop/test1bak/test1</span><br></pre></td></tr></table></figure></div>



<h1 id="聚合和管道"><a href="#聚合和管道" class="headerlink" title="聚合和管道"></a>聚合和管道</h1><p>聚合 aggregate</p>
<p>管道：前面的输出是后面的输入</p>
<p>常用管道：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在mongodb中，⽂档处理完毕后， 通过管道进⾏下⼀次处理</span><br><span class="line">常用管道如下：</span><br><span class="line">$group： 将集合中的⽂档分组， 可⽤于统计结果</span><br><span class="line">$match： 过滤数据， 只输出符合条件的⽂档</span><br><span class="line">$project： 修改输⼊⽂档的结构， 如重命名、 增加、 删除字段、 创建计算结果</span><br><span class="line">$sort： 将输⼊⽂档排序后输出</span><br><span class="line">$limit： 限制聚合管道返回的⽂档数</span><br><span class="line">$skip： 跳过指定数量的⽂档， 并返回余下的⽂档</span><br><span class="line">$unwind： 将数组类型的字段进⾏拆分</span><br></pre></td></tr></table></figure></div>

<p>表达式：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">处理输⼊⽂档并输出</span><br><span class="line">语法：表达式:&#39;$列名&#39;</span><br><span class="line">常⽤表达式:</span><br><span class="line">$sum： 计算总和， $sum:1 表示以⼀倍计数，计算该文档条数</span><br><span class="line">$avg： 计算平均值</span><br><span class="line">$min： 获取最⼩值</span><br><span class="line">$max： 获取最⼤值</span><br><span class="line">$push： 在结果⽂档中插⼊值到⼀个数组中</span><br><span class="line">$first： 根据资源⽂档的排序获取第⼀个⽂档数据</span><br><span class="line">$last： 根据资源⽂档的排序获取最后⼀个⽂档数据</span><br></pre></td></tr></table></figure></div>



<ul>
<li><code>$group、$push、$project、$match</code></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $group</span></span><br><span class="line">将集合中的文档分组，用于统计结果</span><br><span class="line"><span class="comment"># _id表示分组依据</span></span><br><span class="line">例1:统计男生，女生总人数</span><br><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;<span class="variable">$group</span>:</span><br><span class="line">		&#123;</span><br><span class="line">            _id:<span class="string">'$gender'</span>,</span><br><span class="line">            counter:&#123;<span class="variable">$sum</span>:1&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line">输出：</span><br><span class="line">&#123;<span class="string">"id"</span>:<span class="literal">false</span>,<span class="string">"count"</span>:2&#125;</span><br><span class="line">&#123;<span class="string">"id"</span>:<span class="literal">true</span>,<span class="string">"count"</span>:5&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Group by null</span></span><br><span class="line"><span class="comment"># 求学生总人数、平均年龄</span></span><br><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;<span class="variable">$group</span>:</span><br><span class="line">		&#123;</span><br><span class="line">            _id:null,</span><br><span class="line">            counter:&#123;<span class="variable">$sum</span>:1&#125;,</span><br><span class="line">            avgAge:&#123;<span class="variable">$avg</span>:<span class="string">'$age'</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># $project</span></span><br><span class="line"><span class="comment"># 查询学生年龄、姓名</span></span><br><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;<span class="variable">$project</span>:</span><br><span class="line">		&#123;</span><br><span class="line">            _id:0,</span><br><span class="line">            name:1,</span><br><span class="line">            age:1</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询男女生人数，输出人数</span></span><br><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;<span class="variable">$group</span>:</span><br><span class="line">		&#123;</span><br><span class="line">            _id:<span class="string">'$gender'</span>,</span><br><span class="line">            counter:&#123;<span class="variable">$sum</span>:1&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;<span class="variable">$project</span>:&#123;_id:0,counter:1&#125;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># $match</span></span><br><span class="line"><span class="comment"># match是管道命令，能将结果交给后一个管道，但是find不可以</span></span><br><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;<span class="variable">$match</span>:&#123;age:&#123;<span class="variable">$gt</span>:20&#125;&#125;&#125;,</span><br><span class="line">	<span class="comment"># 下一个管道....</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># $push</span></span><br><span class="line"><span class="comment"># 统计不同性别的学生姓名</span></span><br><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;<span class="variable">$group</span>:</span><br><span class="line">		&#123;</span><br><span class="line">            _id:<span class="string">'$gender'</span>,</span><br><span class="line">            name:&#123;<span class="variable">$push</span>:<span class="string">'$name'</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># $$ROOT：将文档内容加入到结果集的数组中</span></span><br><span class="line">db.stu.aggregate(</span><br><span class="line">	&#123;<span class="variable">$group</span>:</span><br><span class="line">		&#123;</span><br><span class="line">            _id:<span class="string">'$gender'</span>,</span><br><span class="line">            name:&#123;<span class="variable">$push</span>:<span class="string">'$$ROOT'</span>&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>



<ul>
<li><code>$sort、$limit、$skip：</code></li>
</ul>
<p>略</p>
<ul>
<li><code>$unwind</code></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">将⽂档中的某⼀个数组类型字段拆分成多条， 每条包含数组中的⼀个值</span><br><span class="line"></span><br><span class="line">语法：db.集合名称.aggregate(&#123;$unwind:&#39;$字段名称&#39;&#125;)</span><br><span class="line"></span><br><span class="line">db.t2.insert(&#123;_id:1,item:&#39;t-shirt&#39;,size:[&#39;S&#39;,&#39;M&#39;,&#39;L&#39;]&#125;)</span><br><span class="line">db.t2.aggregate(&#123;$unwind:&#39;$size&#39;&#125;)</span><br><span class="line"></span><br><span class="line">结果如下：</span><br><span class="line">&#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;t-shirt&quot;, &quot;size&quot; : &quot;S&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;t-shirt&quot;, &quot;size&quot; : &quot;M&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;t-shirt&quot;, &quot;size&quot; : &quot;L&quot; &#125;</span><br></pre></td></tr></table></figure></div>





<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><ul>
<li>创建索引</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">索引：以提升查询速度</span><br><span class="line"></span><br><span class="line">测试：插入10万条数据到数据库中</span><br><span class="line">for(i&#x3D;0;i&lt;100000;i++)&#123;db.t12.insert(&#123;name:&#39;test&#39;+i,age:i&#125;)&#125;</span><br><span class="line"></span><br><span class="line">db.t1.find(&#123;name:&#39;test10000&#39;&#125;)</span><br><span class="line">db.t1.find(&#123;name:&#39;test10000&#39;&#125;).explain(&#39;executionStats&#39;)</span><br><span class="line"># 52ms</span><br><span class="line"></span><br><span class="line">建立索引之后对比：</span><br><span class="line">语法：db.集合.ensureIndex(&#123;属性:1&#125;)，1表示升序， -1表示降序</span><br><span class="line">具体操作：db.t1.ensureIndex(&#123;name:1&#125;)</span><br><span class="line">db.t1.find(&#123;name:&#39;test10000&#39;&#125;).explain(&#39;executionStats&#39;)</span><br><span class="line"># 0ms</span><br></pre></td></tr></table></figure></div>



<ul>
<li>关于索引</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在默认情况下创建的索引均不是唯一索引。</span><br><span class="line">创建唯一索引:</span><br><span class="line">     db.t1.ensureIndex(&#123;&quot;name&quot;:1&#125;,&#123;&quot;unique&quot;:true&#125;)</span><br><span class="line">创建唯一索引并消除重复(name是唯一的，爬虫时用于数据去重)：</span><br><span class="line">     db.t1.ensureIndex(&#123;&quot;name&quot;:1&#125;,&#123;&quot;unique&quot;:true,&quot;dropDups&quot;:true&#125;)  </span><br><span class="line">建立联合索引(什么时候需要联合索引)：</span><br><span class="line">     db.t1.ensureIndex(&#123;name:1,age:1&#125;)</span><br><span class="line">查看当前集合的所有索引：</span><br><span class="line">     db.t1.getIndexes()</span><br><span class="line">删除索引：</span><br><span class="line">     db.t1.dropIndex(&#123;&#39;索引名称&#39;&#125;:1)</span><br></pre></td></tr></table></figure></div>



<ul>
<li>爬虫数据去重，实现增量式爬虫</li>
</ul>
<p>略</p>
<h1 id="与python交互"><a href="#与python交互" class="headerlink" title="与python交互"></a>与python交互</h1><p>设置mongodb远程访问</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sh</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭防火墙 firewalld\iptables</span></span><br><span class="line">systemctl stop firewalld.service <span class="comment">#停止firewall</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service <span class="comment">#禁止firewall开机启动</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置mongodb远程访问</span></span><br><span class="line"><span class="comment"># 编辑mongod.conf注释bindIp,并重启mongodb.(这句配置代表只能本机使用，所以需注释)</span></span><br><span class="line">vim /etc/mongod.conf</span><br><span class="line"></span><br><span class="line">systemctl restart mongod.service</span><br></pre></td></tr></table></figure></div>



<p>增删改查</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立连接</span></span><br><span class="line">client = MongoClient(host=<span class="string">"10.211.55.6"</span>, port=<span class="number">27017</span>)</span><br><span class="line"><span class="comment"># 集合</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line">collection = client[<span class="string">"test02"</span>][<span class="string">"t003"</span>]</span><br><span class="line">collection.insert(&#123;<span class="string">"name"</span>: <span class="string">"mxx"</span>, <span class="string">"age"</span>: <span class="number">18</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入多条数据</span></span><br><span class="line">data_list = [&#123;<span class="string">"name"</span>: <span class="string">"test&#123;&#125;"</span>.format(i)&#125; <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">collection.insert_many(data_list)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询一个记录</span></span><br><span class="line"><span class="comment"># t = collection.find_one(&#123;"name":"xiaowang"&#125;)</span></span><br><span class="line"><span class="comment"># print(t)</span></span><br><span class="line"><span class="comment">#查询所有记录</span></span><br><span class="line">t = collection.find(&#123;<span class="string">"name"</span>:<span class="string">"xiaowang"</span>&#125;)</span><br><span class="line">print(t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in t:</span></span><br><span class="line"><span class="comment">#     print(i)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># for j in t:</span></span><br><span class="line"><span class="comment">#     print(j,"*"*100)</span></span><br><span class="line">print(list(t))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">collection.update_one(&#123;...&#125;)</span><br><span class="line">collection.update_many(&#123;...&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">collection.delete_one(&#123;&#125;)</span><br><span class="line">collection.delete_many(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不用断开连接，会自动断开</span></span><br></pre></td></tr></table></figure></div>

















</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Machine</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://machine4869.gitee.io/2019/03/04/20190304105434006/">https://machine4869.gitee.io/2019/03/04/20190304105434006/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://machine4869.gitee.io">哑舍</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库    </a></div><div class="post_share"><div class="social-share" data-image="/img/default_p2.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/03/21/20190321133211318/"><img class="prev_cover lazyload" data-src="/img/default_p4.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>python爬虫(3)-Scrapy框架</span></div></a></div><div class="next-post pull_right"><a href="/2019/03/01/20190301201943239/"><img class="next_cover lazyload" data-src="/img/default_p10.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>python-杂项</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2018/06/04/15326723152601/" title="redis学习笔记"><img class="relatedPosts_cover lazyload"data-src="/img/default_p1.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2018-06-04</div><div class="relatedPosts_title">redis学习笔记</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'yPVvDIaWlODDhs0bbECwLIIp-gzGzoHsz',
  appKey:'VyOIa40LxnjURzW1HUCiwTpV',
  placeholder:'记得留下你的昵称及邮箱，以便收到答复~',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2020 By Machine</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://machine4869.gitee.io/">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="215,215,215" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>